<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>佐野・横浜重ね合わせマップ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { display: flex; flex-direction: column; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #map-container { flex: 1; position: relative; }
        #map { height: 100%; width: 100%; z-index: 1; }
        #chart-container { 
            height: 25%; min-height: 160px; max-height: 220px; 
            background: white; border-top: 1px solid #e2e8f0; 
            padding: 10px; z-index: 10; display: flex; flex-direction: column; 
        }
        .info-panel {
            position: absolute; top: 12px; left: 12px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(4px);
            padding: 10px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.1);
            z-index: 1000; max-width: 200px;
        }
        .loc-label { background: rgba(0,0,0,0.8); color: white; border-radius: 4px; padding: 2px 6px; font-size: 11px; font-weight: bold; white-space: nowrap; margin-left: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 1px solid white; }
        .km-marker { background: white; color: #333; border-radius: 50%; width: 16px; height: 16px; font-size: 9px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 2px solid #333; }
    </style>
</head>
<body class="bg-gray-50">

    <div id="map-container">
        <div id="map"></div>
        <div class="info-panel shadow-lg">
            <h1 class="text-xs font-black text-indigo-600 uppercase tracking-wider mb-1">SANO OVERLAY</h1>
            <div class="text-[10px] text-slate-500 leading-tight">
                佐野市のスポットを<br>横浜に投影したルート
            </div>
        </div>
    </div>

    <div id="chart-container">
        <div class="flex justify-between items-end mb-2 px-1">
            <div class="flex flex-col">
                <span class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-0.5">竹の家 ⇒ 田沼駅 (via シンフォ)</span>
                <div class="flex items-baseline gap-3">
                    <span class="text-xl font-black text-slate-800">12.9 km</span>
                    <span class="text-xs font-bold text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">↗ 102 m</span>
                </div>
            </div>
            <div class="text-sm font-bold text-slate-600 mb-1">
                3時間5分
            </div>
        </div>
        <div class="flex-1 relative w-full overflow-hidden">
            <canvas id="elevationChart"></canvas>
        </div>
    </div>

    <script>
        const data = {
            poly: "_~twEebasYgAs@c@U[@g@iAEGNOi@m@oCqCLQhAqBnBeDFKGGoAmA_A_AIIl@y@j@y@t@eA|B}CRUDAHDBAX]V]GE@MV[nAaBlBgC`@o@NOdBwB`CaDb@m@z@{AjAkBxBwDb@gA^oA~@}DjA{FViAJ[JKRa@`@m@vBeCJUPMh@q@lAmA^_@h@U~FwAhCm@zEmApA[r@[h@e@n@y@`BwDj@oAh@}@f@g@bE_E`D{CzAwAxAqAtBmBvCoCNH|@Ot@Qr@e@`@OZCbB?TDl@Vt@b@jAb@t@TPDp@AlDsA~BaA|C{@pBi@LEJHDQp@UPILKdBgAx@o@pAkAlCeC^WrA]n@[~Ay@ZCXAREb@MtB_Az@a@pBmAj@]\\s@Pa@|@r@VUZ_@PN`@`@|BbCv@j@nAnAzA|ATPHDh@f@vAnAHJPDx@t@pCzBx@j@XLMq@^KVtAl@Rx@XZHd@HjATpGrAlCh@\\@n@NrAVnA^~@Ph@LpAH`A@xDAc@aFb@`FL^?Vj@@VjCBd@Db@?z@RBCVG`@?ZDRNf@P`@RKzAk@z@e@D@PLBHVOJGP?JPJVhCmBbCiBDEHTLTFn@NRx@lB\\~@tAu@l@[\\GX@J@@V@T\\N\\F\\FtApAb@LfAd@v@Zp@BN@JDp@Jx@HPHpAjABDJIJ?dAC|AWFz@JPJNBEh@^`@^\\V^Nj@PRFNVTHRvCE`B?b@Jf@DXFCTAb@@`AAn@A|@Cp@GPCHH^r@vAtCf@ZNPTEr@SRHNHXZbAjARDFLTj@BLFJCpA@b@CHHDLLFVFHHDHBb@?T?RFb@ZHATALBv@Tf@Jh@?d@IRCJA?HP@\\B^@f@?~@IHCP@|@^x@Tt@@x@AhB\\JBPEPE\\Ob@Ad@AMRABXFFTFVFAR?VCb@Cb@DD?B@?JIHILO|@GjA@VAHERIr@CJHBX@J@NeB\\FN?HgAD[HBNF|@VJOPQXSR?RC`@@FBDCBDFFBFHRXf@|@~AVl@RF\\L`@VJZD^H\\FHVDRBDNR^d@`@ZXJBHRXf@@NH^BH\\Mz@W^Ox@Uf@x@T\\DEFBHLRd@lAjEpBzDp@dAvArBrArAn@d@hDbCdA^hB^VHz@f@l@`@f@j@b@lA~AxFt@hDn@`BrAxDhBrGR|@Jj@N`@V`@TXXNl@NLT\\bAZh@jAT@FLAn@EPAl@Lv@\\`Af@Ql@NHZRKVGRM`@x@`AZTDPDFEBKHa@P",
            dist: 12.9,
            elevations: [19,12,8,7,7,7,8,8,9,12,14,16,16,17,19,24,27,27,26,26,23,22,24,25,25,25,25,25,24,23,23,22,17,14,13,13,13,13,14,15,15,15,15,15,15,15,14,11,10,9,9,9,9,9,8,7,7,7,7,7,8,10,12,15,15,16,10,8,4,0,0,1,2,3,3,3,2,3,2,2,3,4,4,5,5,7,9,11,12,13,13,13,14,17,18,18,19,23,28,31,32,33,36,38,39,40,42,41,41,40,41,43,43,36,26,15,16,17,15,12,8,8,8,8,8,6,5,4,5,4,3,2,2,3,4,4,5,4,5,5,5,4,4,5,7,9,8,10,12,17],
            markers: [{"lat":35.501909700000006,"lng":139.6024588,"name":"仮想: 手打ちラーメン竹の家","originalName":"手打ちラーメン竹の家"},{"lat":35.4614157,"lng":139.6277228,"name":"横浜シンフォステージ (葛生駅相当)","originalName":"葛生駅 (起点)"},{"lat":35.439742700000004,"lng":139.6144028,"name":"仮想: 多田駅","originalName":"多田駅"},{"lat":35.424465700000006,"lng":139.59773679999998,"name":"仮想: 田沼駅","originalName":"田沼駅"}],
            color: "#4f46e5"
        };

        function decode(encoded) {
            var points = [], index = 0, len = encoded.length, lat = 0, lng = 0;
            while (index < len) {
                var b, shift = 0, result = 0;
                do { b = encoded.charCodeAt(index++) - 63; result |= (b & 0x1f) << shift; shift += 5; } while (b >= 0x20);
                var dlat = ((result & 1) ? ~(result >> 1) : (result >> 1)); lat += dlat;
                shift = 0; result = 0;
                do { b = encoded.charCodeAt(index++) - 63; result |= (b & 0x1f) << shift; shift += 5; } while (b >= 0x20);
                var dlng = ((result & 1) ? ~(result >> 1) : (result >> 1)); lng += dlng;
                points.push([lat / 1E5, lng / 1E5]);
            }
            return points;
        }

        let map;

        function init() {
            map = L.map('map', { zoomControl: false }).setView([35.46, 139.62], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
            L.control.zoom({ position: 'topright' }).addTo(map);

            const coords = decode(data.poly);
            
            // Route
            const line = L.polyline(coords, { color: data.color, weight: 6, opacity: 0.8 }).addTo(map);
            map.fitBounds(line.getBounds(), { padding: [50, 50] });

            // Km Markers
            let distAcc = 0;
            let nextKm = 1;
            for (let i = 0; i < coords.length - 1; i++) {
                const A = L.latLng(coords[i]);
                const B = L.latLng(coords[i+1]);
                const dist = A.distanceTo(B) / 1000;
                if (distAcc + dist >= nextKm) {
                    const icon = L.divIcon({
                        className: 'km-marker',
                        html: `<span>${nextKm}</span>`,
                        iconSize: [16, 16], iconAnchor: [8, 8]
                    });
                    L.marker(B, { icon: icon, zIndexOffset: 50 }).addTo(map);
                    nextKm++;
                }
                distAcc += dist;
            }

            // Location Markers
            data.markers.forEach((m, i) => {
                L.circleMarker([m.lat, m.lng], { radius: 6, fillColor: data.color, color: 'white', weight: 3, fillOpacity: 1 }).addTo(map);
                
                // Label (Show original name + virtual note)
                const name = m.originalName.includes('葛生') ? '葛生駅＝横浜シンフォ' : m.originalName;
                const labelIcon = L.divIcon({
                    className: 'loc-label-container',
                    html: `<div class="loc-label">${name}</div>`,
                    iconSize: [120, 20], iconAnchor: [-8, 10]
                });
                L.marker([m.lat, m.lng], { icon: labelIcon, zIndexOffset: 1000 }).addTo(map);
            });

            // Chart
            const ctx = document.getElementById('elevationChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.elevations.map((_, i) => {
                        return (data.dist * (i / (data.elevations.length - 1))).toFixed(1) + "km";
                    }),
                    datasets: [{
                        label: '標高',
                        data: data.elevations,
                        borderColor: data.color,
                        backgroundColor: data.color + "33",
                        borderWidth: 2,
                        fill: true,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { display: true, ticks: { maxTicksLimit: 8, font: {size: 10} }, grid: {display: false} },
                        y: { display: true, title: { display: false }, ticks: { font: {size: 10} } }
                    }
                }
            });
        }
        window.onload = init;
    </script>
</body>
</html>