<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>横浜＆佐野統合ウォーキングマップ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { display: flex; flex-direction: column; height: 100vh; overflow: hidden; font-family: sans-serif; }
        #map-container { flex: 1; position: relative; }
        #map { height: 100%; width: 100%; z-index: 1; }
        #chart-container { height: 28%; min-height: 180px; max-height: 240px; background: white; border-top: 1px solid #e2e8f0; padding: 10px; z-index: 10; display: flex; flex-direction: column; }
        
        .control-panel { 
            position: absolute; top: 12px; right: 12px; 
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(4px);
            padding: 8px; border-radius: 12px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
            z-index: 1000; width: auto; display: flex; flex-direction: column; gap: 6px;
        }
        
        /* Map Switcher Style */
        .map-switch {
            display: flex; background: #e2e8f0; border-radius: 8px; padding: 2px; margin-bottom: 4px;
        }
        .switch-opt {
            flex: 1; text-align: center; padding: 4px 8px; font-size: 10px; font-weight: bold; cursor: pointer; border-radius: 6px; transition: all 0.2s;
        }
        .switch-active { background: white; color: #1e293b; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .switch-inactive { color: #64748b; }

        .btn-toggle { 
            display: block; width: 70px; padding: 6px 0; border-radius: 8px; font-weight: bold; font-size: 11px; text-align: center; border: 1px solid transparent; cursor: pointer; transition: transform 0.1s;
        }
        .btn-toggle:active { transform: scale(0.95); }
        
        .active-5 { background: #8b5cf6; color: white; box-shadow: 0 2px 4px rgba(139,92,246,0.3); }
        .active-10 { background: #10b981; color: white; box-shadow: 0 2px 4px rgba(16,185,129,0.3); }
        .active-20 { background: #2563eb; color: white; box-shadow: 0 2px 4px rgba(37,99,235,0.3); }
        .active-30 { background: #ef4444; color: white; box-shadow: 0 2px 4px rgba(239,68,68,0.3); }
        .active-sano { background: #f59e0b; color: white; box-shadow: 0 2px 4px rgba(245,158,11,0.3); }
        .inactive { background: white; color: #64748b; border-color: #f1f5f9; }
        .hidden-btn { display: none; }

        .loc-label { background: rgba(255,255,255,0.9); border: 1px solid #999; border-radius: 3px; padding: 1px 4px; font-size: 10px; font-weight: bold; white-space: nowrap; margin-left: 8px; box-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .km-marker { background: #333; color: white; border-radius: 50%; width: 14px; height: 14px; font-size: 8px; font-weight: bold; display: flex; align-items: center; justify-content: center; border: 1px solid white; }
    </style>
</head>
<body class="bg-gray-50">

    <div id="map-container">
        <div id="map"></div>
        <div class="control-panel">
            <!-- Map Switcher -->
            <div class="map-switch">
                <div id="sw-yoko" onclick="switchMap('yoko')" class="switch-opt switch-active">横浜MAP</div>
                <div id="sw-sano" onclick="switchMap('sano')" class="switch-opt switch-inactive">佐野MAP</div>
            </div>
            
            <div id="btns-yoko" class="flex flex-col gap-1">
                <button id="b5" onclick="setRoute('5')" class="btn-toggle active-5">5km</button>
                <button id="b10" onclick="setRoute('10')" class="btn-toggle inactive">10km</button>
                <button id="b20" onclick="setRoute('20')" class="btn-toggle inactive">20km</button>
                <button id="b30" onclick="setRoute('30')" class="btn-toggle inactive">30km</button>
                <button id="bsanoY" onclick="setRoute('sano_y')" class="btn-toggle inactive">佐野(仮想)</button>
            </div>
            
            <div id="btns-sano" class="hidden-btn flex flex-col gap-1">
                <button id="bsanoR" onclick="setRoute('sano_r')" class="btn-toggle active-sano">佐野(周回)</button>
            </div>
        </div>
    </div>

    <div id="chart-container">
        <div class="flex justify-between items-end mb-2 px-1">
            <div class="flex flex-col">
                <span id="l-name" class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-0.5">--</span>
                <div class="flex items-baseline gap-3">
                    <span id="l-dist" class="text-xl font-black text-slate-800">-- km</span>
                    <span id="l-ascent" class="text-xs font-bold text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">↗ -- m</span>
                </div>
            </div>
            <div id="l-time" class="text-sm font-bold text-slate-600 mb-1">--</div>
        </div>
        <div class="flex-1 relative w-full overflow-hidden">
            <canvas id="elevationChart"></canvas>
        </div>
    </div>

    <script>
        const data = {
            "5": { 
                poly: "s}lwEaafsYb@`F|AAtBCbAMbAYd@SPXP`@dA`CNHFLCHZv@FNFCbA}@|AqAj@k@\\e@VY@CBBLTJRRJB?F@Ph@EH?@RSh@pAtB}A`Aw@JTD?X@?DGb@ALKfAE^LBZBh@?@AFD@?b@CTHHHJCT@ZGJITET[`@Q\\O@BBHPMNNx@p@TRPTn@t@^^LRH@LIl@c@^Y`@dAJRH@x@[`@|A^^PNt@`BZt@Nd@Pd@^H`@?H?HBFB\\T^\\NLDEFFV\\HHBCFIn@s@FG@BRMd@_@rA_Ab@U`@InAAfASVARFl@Jb@Bb@Ih@KF?@DBFh@^NJhAVXHFDNv@H\\FXJBf@?DBJKJGPMNMBQFGVEL?XzAY{AM?WDGFCPOL]TKJECg@?KCGYI]Mm@EK]MiAWOKi@_@CGAEG?[FMBc@Hc@CmAUeATq@Bk@?WDm@XsA~@e@^SLACGFYXUXGHCBIIW]GGEDOM_@]_@WOEQ@_@COAKKSg@Yw@c@eAg@_AYWMOGSIOMDoAb@kBr@{@X_@HeCP_BJSB[@}AG_@EcDgAWKq@Ik@AO@KDw@`@gAl@[{@q@cBOSKSE[?MKUKUKHwDrCoA~@CEIUMMIAIB]TGKQMaAf@_Bj@KHGMOa@K]CY@[Ho@SC?c@?]Ee@O_BGi@C_@Ka@AYU@U??G]yDE_@", dist: 5.2, dur: 77, ascent: 62,
                color: "#8b5cf6", name: "5km Course",
                elevations: [3,2,2,2,2,2,2,2,2,3,3,4,4,5,6,7,7,7,7,8,8,9,10,11,12,11,11,12,12,13,13,13,13,14,15,16,18,20,22,24,24,25,26,27,27,30,28,26,25,24,23,23,25,26,27,28,30,33,35,37,38,39,39,39,40,41,41,41,40,40,40,40,39,37,33,32,32,36,39,40,40,40,40,41,41,41,40,39,39,39,39,37,36,33,31,29,28,26,25,24,23,24,25,26,28,27,24,22,21,19,18,16,14,13,13,13,13,13,13,13,13,13,12,11,11,11,10,9,8,8,7,6,5,5,5,4,4,4,4,4,4,4,3,2,2,2,2,2,2,3], markers: [{"lat":35.4614157,"lng":139.6277228,"name":"横浜シンフォステージ"},{"lat":35.443594,"lng":139.62255,"name":"野毛山動物園"}]
            },
            "10": { 
                poly: "w}lwE{afsY?e@Ea@WsCGSSmB?UIk@IoAIwBCgC@_C?sBC}@l@OjAa@l@Yp@a@PGPMr@i@HCPQfDeCd@c@~@o@RKZYzBcBpAcAn@e@xAoAlAoAtAyBZi@JWzA}C|AeDXo@LYRYZm@Zi@Tc@JMp@s@p@i@z@g@n@Yp@OdB[TArAOl@Ej@Iz@IrAQx@QXMHERUf@[PIVEH?l@FLa@FKk@e@GEbA}Bz@yByB_BCE?ML]AGOK}@q@CMDICCFOa@Yi@a@EIMUKIQKSUOQ]Wg@Qa@]OUGOGAK@GDCDMKLJBEFELALPNT`@\\f@P\\VNPRTPJJHLTDHn@d@ZTGNp@f@jDhCl@b@TJPDRAFXB^Ib@q@dBNRpE`Df@Z~AhAVVLBfBnApBxANFELd@ZbAt@Sh@FHHLBJVn@?X@TBXRr@R`@FLBRpDbCLRCXKl@|@n@z@h@LRnBvD|DpH`@r@f@|@d@|@N\\`@x@YZg@l@}@bA[^DPb@lAp@zBSLKHBJ~@fDNj@|BhGHROJgAp@qAv@[TSHk@\\{@n@k@h@]b@c@`Aa@~@Yr@Od@[v@Sh@CLSj@e@tAERNRTZr@~@PRGZSjAADE@O@GFK\\Mj@CXGVOJQDQ?OESMm@@c@OSGIPK^OJQBG@VrAY{A_@BKDCNILYRKFKJECg@?KCGYI]Mm@EKCCcBa@OKi@_@CGAEG?[Fg@J]?g@Gg@MMAOBi@Lg@Di@?_@Bm@ReAr@wAbAACGFYX]b@CBIIW]GGEDOM_@]OKOKOEa@?_@CKKKSQi@mAsCMSYWMOGSIOMDoAb@m@TcBl@e@Pi@DyCReAH[@_@CqACgC{@_A]oAM]Ba@Ra@RgAl@[{@q@cBOSKSE[?MKUKU_Ar@cChBoA~@CEIUGKOCg@XSWEAMDuAr@}@XKHGMOa@ISCQA]J_ASC?c@?]Iy@SuBC_@Ka@AYU@U??G]yDE_@", dist: 8.7, dur: 125, ascent: 83,
                color: "#10b981", name: "10km Course",
                elevations: [3,4,4,3,2,1,1,1,1,1,2,3,4,5,7,11,14,14,9,3,0,2,3,4,5,6,5,4,4,4,4,3,2,0,3,3,4,5,5,4,4,2,0,1,1,1,1,1,1,1,1,1,1,1,2,5,7,7,9,10,11,12,13,13,13,13,13,13,13,12,11,11,11,11,12,12,11,10,10,9,7,8,10,9,9,9,9,9,8,7,8,8,8,7,6,5,6,6,7,8,9,10,16,26,32,32,36,40,40,40,41,41,39,39,38,35,31,28,26,24,24,25,27,26,22,19,17,14,13,13,13,13,13,12,11,10,9,8,6,5,5,4,4,4,4,3,2,2,2,3], markers: [{"lat":35.4614157,"lng":139.6277228,"name":"横浜シンフォステージ"},{"lat":35.4511821,"lng":139.6473312,"name":"大さん橋"},{"lat":35.440465,"lng":139.633276,"name":"伊勢佐木長者町駅"},{"lat":35.443594,"lng":139.62255,"name":"野毛山動物園"}]
            },
            "20": { 
                poly: "w}lwE{afsYEgAs@uGSqCM_GAqHfDkAtAw@nA_AfDeCxB_BvC}B`CiBxAoAlAoAtAyBbC_F|AeDrB{D`@q@p@s@lBqA`Bi@nEm@tCYlCc@XM\\[x@e@VEv@FLa@FKk@e@GEbA}Bz@yByB_BCSL]QS}@q@CMDIBSqAeAY_@u@s@eAi@a@]_@g@SFQEPDTG\\f@`@\\f@PdAbA@FITVTbAr@dGnEn@b@`@HLADPBP@Z{@bCnF~DhCfBxDnCdAp@@R`BjAOl@NXXt@?`@Ht@Tr@PZDH@NVLdCdB\\ZDNOjAe@hAmBbDl@v@j@dAFJS^DJnApB~C|EtBfDALn@bA`@p@j@fB~AzFr@zBjAjDh@`BtArDdBxEpB|FdBbFh@vATd@BTp@jBd@`@r@v@RNTB`@TlAhDj@|AvAbI|@`F`ApFb@`Ch@p@hAdADDKV[r@a@x@GLDDc@x@ELLNRRHHRRHJ?NHT?FU\\ZTd@n@J\\E^[ZR\\IRDHFPPTV\\JRr@fArB~C?NNRrCnErB~CvAzB`CbEHL?^rA`AZb@r@dB~AfGb@tB~BpGt@hCg@XFTd@bB^zAP`A\\v@X^TPd@JXPXx@`@v@`@Pl@JND`AGvA`@`Bx@bAb@r@d@NVLT_@bBGPPJI~@E\\VX`@h@sB`@g@Bc@KKC]p@MXSB_AP{BXcBJw@Jg@U{AYkJoAqC_@WIa@a@sCuC}AsDYs@Uk@UDo@R_@AMAUD_@LeAl@iAkAm@SWqAEUUFkA\\o@B}@Hg@NMV}AnAkDjAs@d@KHOKkBdC]p@u@xC[`AW^_A|@e@Pw@L_GDwBIcGCyC?eD_@OAWDYdAQf@M\\u@_@k@e@u@k@{@q@{HgGmCsBu@m@OQICYIUG}AmAqAaAW]_Am@gBwAgCiBwFkEsDqCsB}AKQGHOBPEP[OOc@e@Y[gAgAuByBcBaBmAwAuCwCw@w@W]c@SyBw@yAi@yFuB_IsCy@Yk@_@sAy@wCwB}IiHiCmBkBwAaCqCmAw@sC}A}B{A_Ay@y@mAEIOJUVAIWm@O]Us@Is@@]OAAGYiAq@sEk@aEQcCK_Ek@}Gc@_De@_F_@yIGaDAi@DGOC}@{@_@UsBmBmB_BwGgGgGmFiAcAs@m@SCeA\\c@JDVDd@Ee@EWrA]tBgAt@Ql@Gb@MpDaB|CkB\\s@Pa@|@r@VUZ_@r@p@|BbCv@j@nAnAdD|CvAnAZPx@t@pCzBx@j@XLMq@^KVtAl@Rx@X`ARjATjJlB`C`@bDv@~@PzBVzF?c@aF", dist: 18.9, dur: 266, ascent: 125,
                color: "#2563eb", name: "20km Course",
                elevations: [3,4,2,1,1,2,5,11,12,0,2,5,6,4,4,2,3,5,4,1,1,1,1,1,1,3,7,10,11,13,13,13,11,12,12,11,12,10,10,10,9,7,7,7,7,7,6,6,7,7,5,4,5,5,4,4,4,4,5,6,5,5,5,5,4,4,6,9,9,10,20,22,22,21,20,14,10,7,7,7,8,9,12,13,14,16,21,32,33,29,16,12,10,12,12,12,11,7,5,4,6,6,6,5,6,6,6,5,5,6,6,6,5,6,6,7,10,10,10,14,15,18,25,27,25,19,13,15,13,12,10,9,9,9,7,7,7,7,9,13,15,14,9,4,0,1,3,3,2,3], markers: [{"lat":35.4614157,"lng":139.6277228,"name":"横浜シンフォステージ"},{"lat":35.4511821,"lng":139.6473312,"name":"大さん橋"},{"lat":35.4242129,"lng":139.5974097,"name":"弘明寺観音"},{"lat":35.4534385,"lng":139.6029147,"name":"天王町駅前公園"},{"lat":35.476034,"lng":139.6300295,"name":"横浜銀行アイスアリーナ"}]
            },
            "30": { 
                poly: "w}lwE{afsYmAoNOqP|FcChOcLzEyDbDiEtIaQrAeBlBqA`Bi@nEm@bH}@pBoAnA@La@c@q@vB}F}BsBL]QSaA_AH]qAeAoAsAeAi@aAeASFQEPDTG\\f@hAn@dAbAG\\zAhAdGnEpAl@V`@@Z{@bCnF~DhCfBxDnCfAdA`BjAOl@NXXvA^hBp@bAhDpCu@tCmBbDl@v@j@dAEv@nFnIbDxFlAxCrCvJjE`M`KnYvAlCr@v@jAh@xBfGtCdP`ApFb@`Ch@p@hAdAa@pAc@lAc@x@F\\\\\\RRHZHT?FU\\ZTd@n@J\\E^[ZR\\C\\Xf@b@p@r@fArB~CNb@rCnErB~CvAzB`CbEHl@rA`AnAhC~AfGbDfKt@hC_@n@d@bB^zAP`Av@vAz@\\tAbC~Ab@`AGvA`@`Bx@bAb@r@d@NVQxBGPPJI~@E\\VX`@h@sB`@g@Bc@Ki@l@a@\\_AP{BXcBJw@Jg@U{AYkJoAqC_@y@k@sCuC}AsDYs@k@e@oAPcAPeAl@wB_BWqA[M{B`@eBXkBfBkDjAs@d@[AiCvDu@xCs@`B_A|@}A^_GD{JMyC?eD_@g@BYdAg@~AK|@YHO|A]jC{BYYv@Il@c@bAWfBg@pBc@z@cAbCWdBq@~EAJ[IId@EHIHKJYv@k@h@}BBYCo@nA]ZqBd@s@N[BCTCLkANs@TK^iAJ{B_@]Oi@i@qAO}BU}DSeAGFt@r@nDXhAW\\q@@]Sw@FVfAAb@c@w@UIHf@]JYJaAK_ClAi@l@k@Am@gAeA_Bo@uAG_@UIG_Ao@s@Ck@Kk@i@SkBUoCY[Ie@UmAKuBKk@_A_@kBaAqDkBd@wAcCWm@_A{CSe@KWWUa@He@LUM}C}Bo@_@k@JkExCg@TqBa@cAtCiGnDgAv@cB\\]BSt@Gf@Bd@i@`@q@E[_@w@WaDSY_AAMSNSr@sALsAH]g@Eo@CgAE_AOOO}AEiADaEKqAU`@}@l@CtA?j@a@DKLYLKBKn@DzAYaEPmB_@BcDeAd@mCd@}Aa@QuAx@e@VSk@Yg@KUq@yAI{Cr@sBp@{EY{Dc@eBgAoAsC{DoAuB@qC}@sAkA?SOCUjB[`Am@Qo@WeD@yCAwb@?sG^E?cB@{GCiHIuIOiSTwBdB_E~DaLBwJ?kDYoBn@aBoAsA_AgBcBwBQu@Gu@T[NWKc@Kq@MgC`FsBfAMbDqAfDmBh@c@f@iA|@r@RQFI^QxAvAtClChI|H`FxDnAv@Mq@^KVtAf@P\\Lv@TnATdI`BdKtBbB\\fEHxBIc@yE", dist: 23.1, dur: 330, ascent: 208,
                color: "#ef4444", name: "30km Course",
                elevations: [3,3,1,1,2,5,13,7,2,4,5,4,3,2,4,4,1,1,1,1,1,5,9,11,13,13,13,11,12,11,10,10,10,9,7,7,7,7,6,6,7,6,4,5,5,4,4,4,6,5,5,5,5,4,5,9,9,13,22,22,21,19,12,8,7,7,8,11,13,14,16,29,33,30,14,12,13,18,17,18,21,38,51,58,54,46,50,52,53,49,46,42,35,26,7,6,5,9,18,33,34,49,51,51,53,57,56,60,60,60,58,58,51,44,37,34,29,28,27,30,29,23,22,19,18,18,17,20,19,15,13,13,14,14,12,10,8,7,7,7,10,14,16,9,4,0,2,3,2,3], markers: [{"lat":35.4614157,"lng":139.6277228,"name":"横浜シンフォステージ"},{"lat":35.4511821,"lng":139.6473312,"name":"大さん橋"},{"lat":35.4242129,"lng":139.5974097,"name":"弘明寺観音"},{"lat":35.4549936,"lng":139.5857516,"name":"保土ケ谷公園"},{"lat":35.4732806,"lng":139.5908372,"name":"横浜国立大学"},{"lat":35.476034,"lng":139.6300295,"name":"横浜銀行アイスアリーナ"}]
            },
            "sano_y": {
                poly: "s}lwEaafsYb@`FLv@j@@VjCBd@D~AF|@Dn@Nf@d@T|CoAPLf@M\\PtCuAbCiBd@tAhA`C\\~@tAu@l@[\\Gf@Z^d@z@N`EdCvDr@|C~A~D_@Fz@ZZhCfB~@Xd@`@RvCEdCX|@x@?pBCnBKz@x@vAtClAf@fAIlBpB|@xAAtBl@dAvAJpAZ~A`@bBMzANpBMhCv@nB?hB\\pBYVPABXFFTb@Tz@Gl@Rc@tAM`CIr@^PZcBl@FHgA^O|@Vv@u@f@C~@V`BzCjBzAb@bBdAx@vArAZv@H^`@CzAg@x@Uf@x@T\\VJRd@lAjEzFtJlH|FnD~@`CrAjAxB~AxFxDdMxC~KtBzAfAbCjCTvBh@`Af@Av@Nj@GRM`@x@`A`@f@yAnAC`Aq@nBcFr@{BN_AW}MgB{B_@}CuC{CoGk@e@o@Rm@CkA\\OH_@X{@eAc@M]WUsAg@DyB\\yAZ{BjBiDlAo@d@oBfBy@rBy@xCmBvBiJXsJG}Hc@k@z@Sl@e@~BYHGj@OxAMz@Y^qBYc@dAcBKe@~@_Br@aHlCwG~B}Ib@qAAc@b@s@vB_@jA_Am@uBs@}DYuB@iA{Aq@qAMaAa@Og@Le@RC\\RXYPc@V]Ty@gAe@X]`@PY_@{@_@WJk@u@g@f@gB~@JJoA~@{BcDuFkAmCqCqDsHkFaFcD_AjBwAeAi@SiBk@}En@[oAaAs@}AAqAg@kBZiCE{Bo@uBIeCw@qBIeAc@o@`A_Fg@o@e@w@uAyDI{@PsDTkAQcBsA{CsBeDMgAMi@QeAv@uAb@qA@qLlBoDAkD{@gK}BoImDgIgEkM_HuGgFkEeCsFg@_JM_CAq@AZc@wDEmEEiGCuFMuFc@yEoD_Av@yCxDi@KSLsCJeK{GI_@k@@Wt@e@CyEqDkBuBeFoE_FgEcE_Ig@uAaAjAeBhBWVUVI_@K_@QXa@JoFF_ESyBFoD?MKEE]^LlAL|ELV|@E}@DMWM}EMmA\\_@DDLJnD?p@EfAAn@P~JE|@q@`CoC`HsIjFeGIg@[b@Jk@f@Jt@q@h@_@\\Nz@CjCnAfAs@TJtAJl@o@tCiBlC]rAv@xEa@|GuBdANdBbBt@bAf@Tz@q@fBJ|BA|Er@rAh@zEtA~BaExFsGbKoC`J{BzA{@pAsB~DwHxLkLtG}FhBuAhBYzAw@`CG~FzBlC[zMqEdC}@zCsBbFsEtBy@nD}A|FqB|CkBv@{ApA`@FI^Qd@^tB|BvBlBdIjHfF~Dh@\\P}@~@fB\\LpAXfAVjIbBnKxB|HXdAG]yDE_@", dist: 26.6, dur: 387, ascent: 277,
                color: "#f59e0b", name: "Sano Loop (Virtual)",
                elevations: [3,2,4,5,9,12,13,14,18,19,29,32,37,39,42,40,42,38,15,16,10,8,8,5,4,3,2,4,5,5,5,4,7,8,13,23,21,19,11,7,7,7,10,13,14,16,31,33,22,12,13,24,40,47,55,55,43,31,27,32,18,11,8,7,10,10,20,42,50,49,45,49,53,50,38,32,28,32,48,52,48,40,39,37,33,29,24,20,20,21,21,16,15,15,9,10,10,10,13,15,14,13,10,4,2,3,5,3,2,5,9,18,25,26,18,14,14,10,12,18,21,22,23,25,25,24,23,18,13,13,14,15,15,15,13,9,9,9,7,7,7,9,13,16,8,0,0,3,3,3], markers: [{"lat":35.4614157,"lng":139.6277228,"name":"葛生駅＝シンフォ"},{"lat":35.439742700000004,"lng":139.6144028,"name":"仮想: 多田駅"},{"lat":35.424465700000006,"lng":139.59773679999998,"name":"仮想: 田沼駅"},{"lat":35.4569691,"lng":139.59158979999998,"name":"仮想: JA佐野 三好支店"},{"lat":35.516224400000006,"lng":139.61167859999998,"name":"仮想: 鈴庵"}]
            },
            "sano_r": {
                poly: "k{c}EesbsYRbA@dBBpATlA^xAHj@FXjAh@~AJdHR~It@~@RzC`BzHfEzF~B|@`@H@Va@Pc@NAdDvB~C|@nHbEnBEnBt@bBtAh@^h@JfBOlAs@j@iAHo@Ng@hBd@|G|@`JtAlAVbAb@rAnAl@jAp@dC`C|MdAjGCHG@OAUMTLN@NDj@nC~AfElApBlAxAxC`CtCtBtYdSlFvDqAjMKpBTfBVf@nCzCL?tCfA~C|@x@d@nFtC`FbAh@WJfAm@|FHTBDBTRFpFDAbB`A@eBAyECCeBkBK_GCgEC{AKgBa@_@OYp@g@nAoAtCQZGIQTg@`@a@`@eA~@_BzAiChCuG|GiCbCeAx@wDvDKNQF[@mDB{F^u@@YH_ALsD^sDVgBHcFAmGAuAKgF}@{E@uGWwHViCd@aCl@kDp@{@JuCD_FHcEC}HsAKCOMNy@Mv@CLaAOmAQ_BGaEMwFTcAMmGsB_F_Aq@Qy@k@o@i@c@w@aAcAm@s@{Bk@gAAq@AQAYg@a@J[F[F[FuAQg@QIC?k@?{AAe@s@OkA[gC}@yAEs@Eo@Pi@?qAl@wA|@k@QwBcAg@AU@OUSsA{@gEY_CR}Dl@eHd@iDh@sB^sEQsBs@gCQcAKmBUyE_AyJmAuEw@}BkAiC}AwAk@i@g@y@u@}BgAcHe@uA_BeCq@yAcAmDwDuJuAsDUc@[Zo@j@{BbAmGpCiE`CiBrA{DnEeEfEy@t@_Af@gBf@cRhE_Fr@sF|AgCh@_CPeDDgALeHfC}JtDeA\\_AJq@Iq@YwBsCiCqAkBo@qD_@uC]wH_C_BQ{CLyA?kA_@gBaA}By@eBu@s@MqANg@X_AdAmAt@}CvBo@VqB@m@Bc@RqAdAkAVgCZkB|@y@LgC@yAKeCt@kHjC_A\\~@]h@SpDqAfEyAtADrBDrAKpB_AnAWvBWxAcA~@a@zB@v@SlBwAvBkA~@eANQ?Sp@W^I|AJnH~CnAh@`AJzCQvA@~A\\zH|BdHv@dBl@|BdATRLNFGXQRMr@Qh@OhAgApAiBpAiBdBcBz@c@vAg@pBaAbDoB~CsBrKoDtE}ApD{@vKwCd@{Ar@iAlBkA`FyBrCkAr@i@pAw@xAa@|AeAnBcBhDuBxEaDd@_@NKP?n@c@r@_@dB}@rEuBtJiExBaAnBsA`E}BbA_AbCeD|@uAn@w@pGYhFUzDHfDjAnD|AjLtEfE~Az@X~@TzB_CfBw@FQKg@KgAIoDMi@", dist: 25.3, dur: 345, ascent: 203,
                color: "#f59e0b", name: "Sano Loop (Real)",
                elevations: [94,94,91,91,91,88,85,85,85,84,81,80,80,78,76,74,75,72,75,73,72,70,70,68,67,66,66,66,66,65,64,62,62,60,59,60,62,63,65,66,67,67,69,70,72,72,75,76,77,79,80,82,84,85,85,86,87,89,90,91,91,93,96,96,97,99,110,108,108,113,118,121,130,140,192,149,140,135,126,119,114,108,107,105,107,110,110,114,115,116,118,119,120,121,123,125,130,129,132,135,139,140,145,153,156,155,155,159,163,163,160,156,155,157,155,148,143,140,137,133,131,130,126,126,126,122,122,121,118,117,115,114,114,111,109,107,107,107,105,104,102,102,103,99,97,95,95,94,93,94], markers: [{"lat":36.397506,"lng":139.610264,"name":"葛生駅"},{"lat":36.375833,"lng":139.596944,"name":"多田駅"},{"lat":36.360556,"lng":139.580278,"name":"田沼駅"},{"query":"栃木県佐野市戸室町1054","name":"JA佐野 三好支店","lat":36.3930594,"lng":139.574131},{"query":"栃木県佐野市仙波町 鈴庵","name":"鈴庵","lat":36.4523147,"lng":139.5942198}]
            }
        };

        function decode(encoded) {
            var points = [], index = 0, len = encoded.length, lat = 0, lng = 0;
            while (index < len) {
                var b, shift = 0, result = 0;
                do { b = encoded.charCodeAt(index++) - 63; result |= (b & 0x1f) << shift; shift += 5; } while (b >= 0x20);
                var dlat = ((result & 1) ? ~(result >> 1) : (result >> 1)); lat += dlat;
                shift = 0; result = 0;
                do { b = encoded.charCodeAt(index++) - 63; result |= (b & 0x1f) << shift; shift += 5; } while (b >= 0x20);
                var dlng = ((result & 1) ? ~(result >> 1) : (result >> 1)); lng += dlng;
                points.push([lat / 1E5, lng / 1E5]);
            }
            return points;
        }

        let map, currentLayer, markerGroup, kmGroup, chartInstance;
        let currentMode = 'yoko'; // 'yoko' or 'sano'

        function init() {
            map = L.map('map', { zoomControl: false }).setView([35.455, 139.63], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap' }).addTo(map);
            L.control.zoom({ position: 'topleft' }).addTo(map);
            markerGroup = L.layerGroup().addTo(map);
            kmGroup = L.layerGroup().addTo(map);

            const ctx = document.getElementById('elevationChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { display: false }, tooltip: { mode: 'index', intersect: false } },
                    scales: {
                        x: { display: true, ticks: { maxTicksLimit: 8, font: {size: 10} }, grid: {display: false} },
                        y: { display: true, title: { display: false }, ticks: { font: {size: 10} } }
                    },
                    elements: { point: { radius: 0 } },
                    interaction: { mode: 'nearest', axis: 'x', intersect: false }
                }
            });

            setRoute('5');
        }

        function switchMap(mode) {
            currentMode = mode;
            const swYoko = document.getElementById('sw-yoko');
            const swSano = document.getElementById('sw-sano');
            const btnsYoko = document.getElementById('btns-yoko');
            const btnsSano = document.getElementById('btns-sano');

            if (mode === 'yoko') {
                swYoko.className = 'switch-opt switch-active';
                swSano.className = 'switch-opt switch-inactive';
                btnsYoko.style.display = 'flex';
                btnsSano.style.display = 'none';
                setRoute('5');
            } else {
                swYoko.className = 'switch-opt switch-inactive';
                swSano.className = 'switch-opt switch-active';
                btnsYoko.style.display = 'none';
                btnsSano.style.display = 'flex';
                setRoute('sano_r');
            }
        }

        function setRoute(id) {
            if (currentLayer) map.removeLayer(currentLayer);
            markerGroup.clearLayers();
            kmGroup.clearLayers();
            
            const d = data[id];
            const coords = decode(d.poly);
            
            currentLayer = L.polyline(coords, { color: d.color, weight: 5, opacity: 0.8 }).addTo(map);
            map.fitBounds(currentLayer.getBounds(), { padding: [20, 20] });

            // Km Markers
            let distAcc = 0;
            let nextKm = 1;
            for (let i = 0; i < coords.length - 1; i++) {
                const A = L.latLng(coords[i]);
                const B = L.latLng(coords[i+1]);
                const dist = A.distanceTo(B) / 1000;
                if (distAcc + dist >= nextKm) {
                    const icon = L.divIcon({
                        className: 'km-marker',
                        html: `<span>${nextKm}</span>`,
                        iconSize: [14, 14], iconAnchor: [7, 7]
                    });
                    L.marker(B, { icon: icon, zIndexOffset: 50 }).addTo(kmGroup);
                    nextKm++;
                }
                distAcc += dist;
            }

            // Location Markers
            d.markers.forEach((m) => {
                L.circleMarker([m.lat, m.lng], { radius: 4, fillColor: 'white', color: d.color, weight: 2, fillOpacity: 1 }).addTo(markerGroup);
                const labelIcon = L.divIcon({
                    className: 'loc-label-container',
                    html: `<div class="loc-label">${m.name}</div>`,
                    iconSize: [120, 20], iconAnchor: [-6, 8]
                });
                L.marker([m.lat, m.lng], { icon: labelIcon, zIndexOffset: 1000 }).addTo(markerGroup);
            });

            document.getElementById('l-dist').innerText = d.dist + " km";
            document.getElementById('l-ascent').innerText = "↗ " + d.ascent + " m";
            
            const hours = Math.floor(d.dur / 60);
            const mins = d.dur % 60;
            document.getElementById('l-time').innerText = `${hours > 0 ? hours + 'h ' : ''}${mins}m`;
            
            document.getElementById('l-name').innerText = d.name;
            document.getElementById('l-name').style.color = d.color;

            // Button active state
            const allIds = ['5', '10', '20', '30', 'sanoY', 'sanoR'];
            const btnIdMap = { '5':'b5', '10':'b10', '20':'b20', '30':'b30', 'sano_y':'bsanoY', 'sano_r':'bsanoR' };
            
            Object.values(btnIdMap).forEach(bid => {
                const el = document.getElementById(bid);
                if(el) el.classList.replace('active-5', 'inactive');
                if(el) el.classList.replace('active-10', 'inactive');
                if(el) el.classList.replace('active-20', 'inactive');
                if(el) el.classList.replace('active-30', 'inactive');
                if(el) el.classList.replace('active-sano', 'inactive');
            });

            const activeBtn = document.getElementById(btnIdMap[id]);
            if(activeBtn) {
                let activeClass = 'active-5';
                if(id === '10') activeClass = 'active-10';
                if(id === '20') activeClass = 'active-20';
                if(id === '30') activeClass = 'active-30';
                if(id.includes('sano')) activeClass = 'active-sano';
                activeBtn.classList.replace('inactive', activeClass);
            }

            updateChart(d);
        }

        function updateChart(d) {
            const count = d.elevations.length;
            const labels = d.elevations.map((_, i) => {
                const current = (d.dist * (i / (count - 1))).toFixed(1);
                return current + "km";
            });

            chartInstance.data = {
                labels: labels,
                datasets: [{
                    label: 'Elevation',
                    data: d.elevations,
                    borderColor: d.color,
                    backgroundColor: d.color + "33",
                    borderWidth: 2,
                    fill: true,
                    tension: 0.4
                }]
            };
            chartInstance.update();
        }

        window.onload = init;
    </script>
</body>
</html>